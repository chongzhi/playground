<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="股票记录">
    <title>股票记录 - 移动端应用</title>
    
    <!-- CSS 文件 -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/mobile.css">
    
    <!-- PWA 相关 -->
    <meta name="theme-color" content="#007bff">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">
    <link rel="apple-touch-icon" href="assets/icons/icon-180.png">
    
    <!-- 防止页面缓存 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <div class="app-layout">
        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 内容会通过 JavaScript 动态加载 -->
            <div class="loading">
                <div>正在加载应用...</div>
            </div>
        </main>
        
        <!-- 底部导航栏 -->
        <nav class="bottom-nav">
            <div class="nav-container">
                <div class="nav-item active" data-nav="dashboard">
                    <div class="nav-icon">📊</div>
                    <div class="nav-label">首页</div>
                </div>
                <div class="nav-item" data-nav="transactions">
                    <div class="nav-icon">📋</div>
                    <div class="nav-label">记录</div>
                </div>
                <div class="nav-item" data-nav="add-transaction">
                    <div class="nav-icon">➕</div>
                    <div class="nav-label">添加</div>
                </div>
                <div class="nav-item" data-nav="holdings">
                    <div class="nav-icon">💼</div>
                    <div class="nav-label">持仓</div>
                </div>
                <div class="nav-item" data-nav="statistics">
                    <div class="nav-icon">📈</div>
                    <div class="nav-label">统计</div>
                </div>
            </div>
        </nav>
    </div>

    <!-- JavaScript 文件 -->
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/transaction.js"></script>
    <script src="js/holdings.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/app.js"></script>
    
    <!-- 初始化脚本 -->
    <script>
        // 页面加载完成后初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            // 应用已经在 app.js 中自动初始化
            console.log('股票记录应用已启动');
        });
        
        // 服务工作者注册（如果需要 PWA 功能）
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/stock-cursor/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // 防止页面刷新时的确认提示
        window.addEventListener('beforeunload', function(e) {
            // 在这里可以检查是否有未保存的数据
            // 如果需要提示用户，可以设置 returnValue
            // e.returnValue = '您有未保存的更改，确定要离开吗？';
        });
        
        // 处理网络状态变化
        window.addEventListener('online', function() {
            Utils.showMessage('网络连接已恢复', 'success');
        });
        
        window.addEventListener('offline', function() {
            Utils.showMessage('网络连接已断开，应用仍可离线使用', 'warning');
        });
        
        // 处理页面可见性变化
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // 页面隐藏时可以执行清理操作
                console.log('页面已隐藏');
            } else {
                // 页面重新可见时可以刷新数据
                console.log('页面已显示');
                if (window.app) {
                    window.app.refreshCurrentPage();
                }
            }
        });
        
        // iOS Safari 特殊处理
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            // 防止页面滚动时的橡皮筋效果
            document.addEventListener('touchmove', function(e) {
                if (e.target.closest('.main-content') === null) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // 防止双击缩放
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }
    </script>
</body>
</html>