<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="è‚¡ç¥¨è®°å½•">
    <title>è‚¡ç¥¨è®°å½• - ç§»åŠ¨ç«¯åº”ç”¨</title>
    
    <!-- CSS æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/mobile.css">
    
    <!-- PWA ç›¸å…³ -->
    <meta name="theme-color" content="#007bff">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">
    <link rel="apple-touch-icon" href="assets/icons/icon-180.png">
    
    <!-- é˜²æ­¢é¡µé¢ç¼“å­˜ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <div class="app-layout">
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- å†…å®¹ä¼šé€šè¿‡ JavaScript åŠ¨æ€åŠ è½½ -->
            <div class="loading">
                <div>æ­£åœ¨åŠ è½½åº”ç”¨...</div>
            </div>
        </main>
        
        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <nav class="bottom-nav">
            <div class="nav-container">
                <div class="nav-item active" data-nav="dashboard">
                    <div class="nav-icon">ğŸ“Š</div>
                    <div class="nav-label">é¦–é¡µ</div>
                </div>
                <div class="nav-item" data-nav="transactions">
                    <div class="nav-icon">ğŸ“‹</div>
                    <div class="nav-label">è®°å½•</div>
                </div>
                <div class="nav-item" data-nav="add-transaction">
                    <div class="nav-icon">â•</div>
                    <div class="nav-label">æ·»åŠ </div>
                </div>
                <div class="nav-item" data-nav="holdings">
                    <div class="nav-icon">ğŸ’¼</div>
                    <div class="nav-label">æŒä»“</div>
                </div>
                <div class="nav-item" data-nav="statistics">
                    <div class="nav-icon">ğŸ“ˆ</div>
                    <div class="nav-label">ç»Ÿè®¡</div>
                </div>
            </div>
        </nav>
    </div>

    <!-- JavaScript æ–‡ä»¶ -->
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/transaction.js"></script>
    <script src="js/holdings.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/app.js"></script>
    
    <!-- åˆå§‹åŒ–è„šæœ¬ -->
    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            // åº”ç”¨å·²ç»åœ¨ app.js ä¸­è‡ªåŠ¨åˆå§‹åŒ–
            console.log('è‚¡ç¥¨è®°å½•åº”ç”¨å·²å¯åŠ¨');
        });
        
        // æœåŠ¡å·¥ä½œè€…æ³¨å†Œï¼ˆå¦‚æœéœ€è¦ PWA åŠŸèƒ½ï¼‰
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/stock-cursor/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // é˜²æ­¢é¡µé¢åˆ·æ–°æ—¶çš„ç¡®è®¤æç¤º
        window.addEventListener('beforeunload', function(e) {
            // åœ¨è¿™é‡Œå¯ä»¥æ£€æŸ¥æ˜¯å¦æœ‰æœªä¿å­˜çš„æ•°æ®
            // å¦‚æœéœ€è¦æç¤ºç”¨æˆ·ï¼Œå¯ä»¥è®¾ç½® returnValue
            // e.returnValue = 'æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
        });
        
        // å¤„ç†ç½‘ç»œçŠ¶æ€å˜åŒ–
        window.addEventListener('online', function() {
            Utils.showMessage('ç½‘ç»œè¿æ¥å·²æ¢å¤', 'success');
        });
        
        window.addEventListener('offline', function() {
            Utils.showMessage('ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œåº”ç”¨ä»å¯ç¦»çº¿ä½¿ç”¨', 'warning');
        });
        
        // å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // é¡µé¢éšè—æ—¶å¯ä»¥æ‰§è¡Œæ¸…ç†æ“ä½œ
                console.log('é¡µé¢å·²éšè—');
            } else {
                // é¡µé¢é‡æ–°å¯è§æ—¶å¯ä»¥åˆ·æ–°æ•°æ®
                console.log('é¡µé¢å·²æ˜¾ç¤º');
                if (window.app) {
                    window.app.refreshCurrentPage();
                }
            }
        });
        
        // iOS Safari ç‰¹æ®Šå¤„ç†
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            // é˜²æ­¢é¡µé¢æ»šåŠ¨æ—¶çš„æ©¡çš®ç­‹æ•ˆæœ
            document.addEventListener('touchmove', function(e) {
                if (e.target.closest('.main-content') === null) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // é˜²æ­¢åŒå‡»ç¼©æ”¾
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }
    </script>
</body>
</html>