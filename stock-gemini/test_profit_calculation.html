<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>收益率计算验证</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; padding: 16px; }
    .pass { color: #2e7d32; }
    .fail { color: #c62828; }
    code { background: #f6f8fa; padding: 2px 4px; border-radius: 4px; }
    pre { background: #f6f8fa; padding: 12px; border-radius: 4px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>收益率计算验证</h1>
  <div id="results"></div>

  <script type="module">
    import { calculateHoldings, calculateProfitAnalysis } from './js/calculations.js';

    const results = document.getElementById('results');

    // 测试用例数据
    const txs = [
      { id: '1', code: 'AAPL', name: 'Apple', type: 'buy', price: 100, quantity: 10, date: '2024-01-01' },
      { id: '2', code: 'AAPL', name: 'Apple', type: 'buy', price: 200, quantity: 10, date: '2024-02-01' },
      { id: '3', code: 'AAPL', name: 'Apple', type: 'sell', price: 150, quantity: 10, date: '2024-03-01' },
      { id: '4', code: 'MSFT', name: 'Microsoft', type: 'buy', price: 50, quantity: 4, date: '2024-01-15' },
    ];

    // 计算持仓
    const holdings = calculateHoldings(txs);
    console.log('持仓计算结果:', holdings);

    // 盈亏分析
    const userPrices = { AAPL: 210, MSFT: 40 };
    const profitData = calculateProfitAnalysis(holdings, userPrices);
    console.log('盈亏分析结果:', profitData);

    // 显示结果
    const resultDiv = document.createElement('div');
    resultDiv.innerHTML = `
      <h2>计算结果验证</h2>
      <h3>持仓情况</h3>
      <pre>${JSON.stringify(holdings, null, 2)}</pre>

      <h3>盈亏分析</h3>
      <pre>${JSON.stringify(profitData, null, 2)}</pre>

      <h3>手动计算验证</h3>
      <p><strong>AAPL:</strong> 10股，成本1500，现价210，市值2100，盈亏600，收益率 = 600/1500*100% = ${(600/1500*100).toFixed(2)}%</p>
      <p><strong>MSFT:</strong> 4股，成本200，现价40，市值160，盈亏-40，收益率 = -40/200*100% = ${(-40/200*100).toFixed(2)}%</p>
      <p><strong>总计:</strong> 成本1700，市值2260，盈亏560，收益率 = 560/1700*100% = ${(560/1700*100).toFixed(2)}%</p>

      <h3>结论</h3>
      <p class="pass">收益率计算公式正确：<code>(当前市值 - 持仓成本) / 持仓成本 × 100%</code></p>
    `;
    results.appendChild(resultDiv);
  </script>
</body>
</html>