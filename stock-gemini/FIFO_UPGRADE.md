# æˆæœ¬ä»·è®¡ç®—ç®—æ³•å‡çº§ï¼šä»ŽåŠ æƒå¹³å‡åˆ° FIFO

## ðŸ“‹ ä¿®æ”¹æ¦‚è¿°

å°†æŒä»“æˆæœ¬è®¡ç®—æ–¹æ³•ä»Ž **åŠ æƒå¹³å‡æˆæœ¬æ³•** å‡çº§ä¸º **FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰æ³•**ã€‚

### ä¿®æ”¹æ—¥æœŸ
2025-10-31

### ä¿®æ”¹æ–‡ä»¶
- `js/calculations.js` - `calculateHoldings()` å‡½æ•°

---

## ðŸŽ¯ ä¸ºä»€ä¹ˆè¦ä¿®æ”¹ï¼Ÿ

### æ—§ç®—æ³•ï¼ˆåŠ æƒå¹³å‡ï¼‰çš„é—®é¢˜

#### é—®é¢˜ 1ï¼šæˆæœ¬æ··åˆä¸ç›´è§‚
```
1. ä¹°å…¥ 400è‚¡ @ $24.58
2. ä¹°å…¥ 470è‚¡ @ $21.24
â†’ æ··åˆæˆ 870è‚¡ @ $22.78ï¼ˆå¹³å‡ï¼‰

3. å–å‡º 470è‚¡
â†’ å‰©ä½™ 400è‚¡ @ $22.77
```

**é—®é¢˜**ï¼šå‰©ä½™æˆæœ¬ $22.77 æ—¢ä¸æ˜¯ $24.58ï¼Œä¹Ÿä¸æ˜¯ $21.24ï¼Œä¸ç¬¦åˆç›´è§‰ã€‚

#### é—®é¢˜ 2ï¼šç›ˆåˆ©å‡è±¡
```
æŒ‰ä¸Šè¿°ä¾‹å­ï¼š
- ç³»ç»Ÿæ˜¾ç¤ºå‰©ä½™æˆæœ¬ï¼š$22.77
- å¦‚æžœåœ¨ $24.00 å–å‡ºï¼šçœ‹èµ·æ¥èµš $1.23/è‚¡
- ä½†æ•´ä½“çŽ°é‡‘æµè®¡ç®—ï¼šå®žé™…äºæŸ $579.80
```

**é—®é¢˜**ï¼šå·²å®žçŽ°çš„äºæŸè¢«"éšè—"åœ¨å‰©ä½™æŒä»“æˆæœ¬ä¸­ï¼Œè¯¯å¯¼æŠ•èµ„å†³ç­–ã€‚

---

## âœ… æ–°ç®—æ³•ï¼ˆFIFOï¼‰çš„ä¼˜åŠ¿

### 1. æ‰¹æ¬¡ç®¡ç†
æ¯æ‰¹ä¹°å…¥ç‹¬ç«‹è¿½è¸ªï¼Œä¸æ··åˆï¼š
```javascript
lots: [
  { price: 24.58, quantity: 400, date: '2025-01-01' },
  { price: 21.24, quantity: 470, date: '2025-01-02' }
]
```

### 2. å…ˆè¿›å…ˆå‡ºé€»è¾‘
å–å‡ºæ—¶ä»Žæœ€æ—©ä¹°å…¥çš„æ‰¹æ¬¡å¼€å§‹ï¼š
```
å–å‡º 470è‚¡ï¼š
1. å…ˆå–æ‰¹æ¬¡1ï¼š400è‚¡ @ $24.58 âœ“ å…¨å–
2. å†å–æ‰¹æ¬¡2ï¼š70è‚¡ @ $21.24 âœ“ éƒ¨åˆ†å–
â†’ å‰©ä½™ï¼š400è‚¡ @ $21.24ï¼ˆæ‰¹æ¬¡2å‰©ä½™ï¼‰
```

### 3. çœŸå®žæˆæœ¬
å‰©ä½™æŒä»“çš„æˆæœ¬åæ˜ å®žé™…ä¹°å…¥ä»·æ ¼ï¼š
- âœ… $21.24 æ˜¯çœŸå®žä¹°å…¥ä»·
- âŒ ä¸æ˜¯è®¡ç®—å‡ºæ¥çš„å¹³å‡ä»· $22.77

### 4. ç¨ŽåŠ¡åˆè§„
- ç¬¦åˆå¤§å¤šæ•°å›½å®¶ç¨ŽåŠ¡è¦æ±‚
- ä¸Žåˆ¸å•†é»˜è®¤è¡Œä¸ºä¸€è‡´
- ä¾¿äºŽç¨ŽåŠ¡ç”³æŠ¥å’Œå®¡è®¡

---

## ðŸ”§ æŠ€æœ¯å®žçŽ°

### æ ¸å¿ƒæ•°æ®ç»“æž„

```javascript
// æ—§ç®—æ³•
{
  code: 'A',
  name: 'Aè‚¡ç¥¨',
  quantity: 400,
  totalCost: 9108.2,
  avgCost: 22.77
}

// æ–°ç®—æ³•ï¼ˆå¢žåŠ  lots æ‰¹æ¬¡æ•°ç»„ï¼‰
{
  code: 'A',
  name: 'Aè‚¡ç¥¨',
  quantity: 400,
  totalCost: 8496.0,
  avgCost: 21.24,
  lots: [
    { price: 21.24, quantity: 400, date: '2025-01-02' }
  ]
}
```

### ç®—æ³•é€»è¾‘

#### ä¹°å…¥æ“ä½œ
```javascript
if (tx.type === 'buy') {
  // æ·»åŠ æ–°æ‰¹æ¬¡åˆ°é˜Ÿåˆ—æœ«å°¾
  stock.lots.push({
    price: normalizedPrice,
    quantity: tx.quantity,
    date: tx.date,
  });
}
```

#### å–å‡ºæ“ä½œï¼ˆFIFOï¼‰
```javascript
if (tx.type === 'sell') {
  let remainingToSell = tx.quantity;
  
  // ä»Žé˜Ÿåˆ—å¤´éƒ¨å¼€å§‹æ‰£é™¤
  while (remainingToSell > 0 && stock.lots.length > 0) {
    const firstLot = stock.lots[0];
    
    if (firstLot.quantity <= remainingToSell) {
      // è¿™æ‰¹å…¨éƒ¨å–å‡ºï¼Œç§»é™¤
      remainingToSell -= firstLot.quantity;
      stock.lots.shift();
    } else {
      // è¿™æ‰¹éƒ¨åˆ†å–å‡ºï¼Œå‡å°‘æ•°é‡
      firstLot.quantity -= remainingToSell;
      remainingToSell = 0;
    }
  }
}
```

#### æœ€ç»ˆè®¡ç®—
```javascript
// æ±‡æ€»æ‰€æœ‰æ‰¹æ¬¡
let totalQuantity = 0;
let totalCost = 0;

for (const lot of stock.lots) {
  totalQuantity += lot.quantity;
  totalCost = add(totalCost, multiply(lot.price, lot.quantity));
}

// è®¡ç®—åŠ æƒå¹³å‡æˆæœ¬ï¼ˆåŸºäºŽå‰©ä½™æ‰¹æ¬¡ï¼‰
avgCost = divide(totalCost, totalQuantity);
```

---

## ðŸ“Š å®žé™…æ¡ˆä¾‹å¯¹æ¯”

### æµ‹è¯•åœºæ™¯
```
1. ä¹°å…¥ 400è‚¡ @ $24.58
2. ä¹°å…¥ 470è‚¡ @ $21.24
3. å–å‡º 470è‚¡ @ $20.50
```

### ç»“æžœå¯¹æ¯”

| é¡¹ç›® | æ—§ç®—æ³•ï¼ˆåŠ æƒå¹³å‡ï¼‰| æ–°ç®—æ³•ï¼ˆFIFOï¼‰| è¯´æ˜Ž |
|------|------------------|---------------|------|
| **å‰©ä½™æ•°é‡** | 400è‚¡ | 400è‚¡ | ç›¸åŒ |
| **å‰©ä½™æˆæœ¬** | $22.77 | **$21.24** | FIFO æ›´çœŸå®ž |
| **æ‰¹æ¬¡ä¿¡æ¯** | æ—  | æ‰¹æ¬¡2çš„å‰©ä½™ | å¯è¿½æº¯ |
| **é€»è¾‘** | å¹³å‡æ··åˆ | å…ˆè¿›å…ˆå‡º | æ›´ç›´è§‚ |

### å¦‚æžœç»§ç»­åœ¨ $24.00 å–å‡º

| ç®—æ³• | å•æ¬¡ç›ˆäº | æ•´ä½“ç›ˆäº | æ˜¯å¦åŒ¹é… |
|------|---------|---------|---------|
| åŠ æƒå¹³å‡ | +$492 | -$579.80 | âŒ å‡è±¡ |
| FIFO | +$1,096 | -$579.80 | âš ï¸ ä»éœ€æ³¨æ„æ•´ä½“ |

**æ³¨æ„**ï¼šFIFO è§£å†³äº†æˆæœ¬æ··åˆé—®é¢˜ï¼Œä½†å¦‚æžœä¸­é—´æœ‰äºæŸäº¤æ˜“ï¼Œæ•´ä½“ä»å¯èƒ½äºé’±ã€‚å»ºè®®å¢žåŠ "å·²å®žçŽ°ç›ˆäº"æ˜¾ç¤ºã€‚

---

## ðŸš€ åŽç»­æ”¹è¿›å»ºè®®

### 1. æ˜¾ç¤ºå·²å®žçŽ°ç›ˆäº
åœ¨ UI ä¸­åˆ†åˆ«æ˜¾ç¤ºï¼š
- âœ… **å·²å®žçŽ°ç›ˆäº**ï¼šå·²å®Œæˆäº¤æ˜“çš„ç›ˆäº
- âœ… **æœªå®žçŽ°ç›ˆäº**ï¼šå½“å‰æŒä»“æŒ‰å¸‚ä»·çš„ç›ˆäº
- âœ… **æ•´ä½“ç›ˆäº**ï¼šå·²å®žçŽ° + æœªå®žçŽ°

### 2. æ‰¹æ¬¡æ˜Žç»†æŸ¥çœ‹
å…è®¸ç”¨æˆ·æŸ¥çœ‹æ¯åªè‚¡ç¥¨çš„æ‰¹æ¬¡è¯¦æƒ…ï¼š
```
Aè‚¡ç¥¨æŒä»“æ˜Žç»†ï¼š
- æ‰¹æ¬¡1ï¼š200è‚¡ @ $20.50ï¼ˆ2025-01-15ï¼‰
- æ‰¹æ¬¡2ï¼š300è‚¡ @ $22.30ï¼ˆ2025-02-20ï¼‰
```

### 3. æ”¯æŒæŒ‡å®šæ‰¹æ¬¡å–å‡ºï¼ˆé«˜çº§åŠŸèƒ½ï¼‰
å…è®¸ç”¨æˆ·é€‰æ‹©è¦å–å‡ºçš„æ‰¹æ¬¡ï¼ˆç”¨äºŽç¨ŽåŠ¡ä¼˜åŒ–ï¼‰

### 4. ç®—æ³•é€‰æ‹©ï¼ˆå¯é€‰ï¼‰
æä¾›è®¾ç½®é€‰é¡¹è®©ç”¨æˆ·é€‰æ‹©ï¼š
- FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰- é»˜è®¤
- LIFOï¼ˆåŽè¿›å…ˆå‡ºï¼‰
- æŒ‡å®šæ‰¹æ¬¡

---

## âœ… æµ‹è¯•éªŒè¯

### æµ‹è¯•æ–‡ä»¶
- `test_fifo_implementation.html` - FIFO ç®—æ³•åŠŸèƒ½æµ‹è¯•
- `analyze_cost_method.html` - ç®—æ³•å¯¹æ¯”åˆ†æž
- `profit_illusion_analysis.html` - ç›ˆåˆ©å‡è±¡åˆ†æž

### æµ‹è¯•åœºæ™¯è¦†ç›–
- âœ… åŸºæœ¬ä¹°å…¥/å–å‡º
- âœ… å¤šæ‰¹æ¬¡ç®¡ç†
- âœ… FIFO é¡ºåºéªŒè¯
- âœ… éƒ¨åˆ†å–å‡º
- âœ… è·¨æ‰¹æ¬¡å–å‡º
- âœ… æˆæœ¬è®¡ç®—å‡†ç¡®æ€§
- âœ… æ•´ä½“ç›ˆäºéªŒè¯

---

## ðŸ“ å…¼å®¹æ€§è¯´æ˜Ž

### æ•°æ®æ ¼å¼
æ–°ç®—æ³•è¿”å›žçš„æŒä»“å¯¹è±¡å¢žåŠ äº† `lots` å­—æ®µï¼Œä½†ä¿æŒäº†åŽŸæœ‰å­—æ®µçš„å…¼å®¹æ€§ï¼š
- `quantity` - æ€»æ•°é‡
- `totalCost` - æ€»æˆæœ¬
- `avgCost` - å¹³å‡æˆæœ¬
- `lots` - **æ–°å¢ž**ï¼šæ‰¹æ¬¡æ•°ç»„

### UI å…¼å®¹
çŽ°æœ‰ UI æ— éœ€ä¿®æ”¹ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨æ–°çš„ `avgCost` å€¼ã€‚å¦‚æžœéœ€è¦æ˜¾ç¤ºæ‰¹æ¬¡è¯¦æƒ…ï¼Œå¯ä»¥è®¿é—® `lots` å­—æ®µã€‚

---

## ðŸŽ‰ æ€»ç»“

é€šè¿‡å°†ç®—æ³•ä»Ž**åŠ æƒå¹³å‡**å‡çº§ä¸º **FIFO**ï¼š

1. âœ… è§£å†³äº†æˆæœ¬æ··åˆä¸ç›´è§‚çš„é—®é¢˜
2. âœ… çœŸå®žåæ˜ å‰©ä½™æŒä»“çš„ä¹°å…¥æˆæœ¬
3. âœ… æ”¯æŒæ‰¹æ¬¡è¿½æº¯å’Œç®¡ç†
4. âœ… ç¬¦åˆç¨ŽåŠ¡è¦æ±‚å’Œåˆ¸å•†æƒ¯ä¾‹
5. âœ… ä¸ºæœªæ¥é«˜çº§åŠŸèƒ½ï¼ˆå¦‚æŒ‡å®šæ‰¹æ¬¡å–å‡ºï¼‰æ‰“ä¸‹åŸºç¡€

è™½ç„¶ FIFO ä¸èƒ½å®Œå…¨è§£å†³"ç›ˆåˆ©å‡è±¡"é—®é¢˜ï¼ˆéœ€è¦å¢žåŠ å·²å®žçŽ°ç›ˆäºæ˜¾ç¤ºï¼‰ï¼Œä½†å®ƒæä¾›äº†æ›´é€æ˜Žã€æ›´ç¬¦åˆç›´è§‰çš„æˆæœ¬è®¡ç®—æ–¹å¼ã€‚

