# Stock-Gemini 项目总结

更新时间：2025-08-09

## 技术栈与运行方式
- 原生 HTML/CSS/JavaScript，零依赖，无打包流程
- 直接用浏览器打开 `stock-gemini/index.html` 即可运行

## 目录结构
- `index.html`：页面骨架，包含四个主视图（持仓、历史、盈亏、设置）
- `app.js`：全部业务逻辑（状态、计算、渲染、事件）
- `style.css`：全局样式，深色模式与红涨绿跌配色

## 数据模型与持久化
- 交易记录：`{ id, code, name, type: 'buy'|'sell', price: number, quantity: number, date: 'YYYY-MM-DD' }`
- 本地存储键：
  - `stockTransactions`：交易数组
  - `userStockPrices`：用户输入的现价映射
  - `initialFunds`：初始资金（用于现金余额）
  - `exchangeRate`：美元兑人民币汇率
  - `currentTab`：最近一次访问的视图

## 核心功能
- 持仓视图：聚合交易计算持仓，按市值排序；支持“买入/卖出”快捷填单
- 历史视图：按日期倒序展示，支持编辑/删除
- 盈亏视图：基于用户价（或成本价）计算未实现盈亏与收益率，包含总览与逐股明细
- 设置视图：初始资金/汇率配置；生成逐股价格输入；支持导入/导出、清空数据

## 关键业务规则
- 成本法：加权平均成本法（非 FIFO/LIFO）。卖出按当前均价比例冲减 `totalCost`，并更新 `avgCost`
- 现金余额：`余额 = 初始资金 − 买入总额 + 卖出总额`
- 表单校验：
  - 买入前校验余额是否足够（提示最大可买数量）
  - 卖出前校验持仓数量是否足够

## 视觉与交互
- 深色模式适配（`prefers-color-scheme`）
- 红涨绿跌：盈利红色、亏损绿色，符合国内视觉习惯
- 切换视图保持状态（`currentTab`）

## 优点
- 零依赖、即开即用；本地持久化完备（含导入/导出）
- 交互顺畅，关键校验齐全，移动端友好
- 样式与配色符合国内使用习惯

## 限制
- 无实时行情与手续费/税费模型；盈亏仅“未实现”口径，未区分已实现盈亏
- 仅支持加权平均成本法，不适合需要 FIFO/LIFO 或精确税务的场景
- 逻辑集中在单文件 `app.js`，可维护性与可测试性受限
- 使用浮点数进行金额运算，存在精度风险
- 股票代码与市场缺少格式校验与去重
- 仅单一账户/单币种（USD）与统一汇率

## 改进建议（从易到难）
1. 结构化
   - 拆分模块：`storage`、`calculations`、`ui`，引入基础单元测试
2. 金融口径
   - 支持手续费/印花税/佣金；区分已实现与未实现盈亏
   - 可选 FIFO/LIFO 成本法（导出时记录成本法）
3. 精度与数据质量
   - 采用定点/十进制库（如 `big.js`）避免浮点误差
   - 交易与代码的格式校验、去重提示、常用代码选择器
   - 导入数据做 schema 校验与版本迁移
4. 行情与多币种
   - 接入简单行情源或手动批量粘贴价格；考虑跨域代理
   - 支持多账户/多币种与逐标的币种及汇率时间点
5. 易用性与可访问性
   - 移动端输入优化、键盘可达性、ARIA 标签

## 运行方式
- 直接用浏览器打开 `stock-gemini/index.html`
- 若需要本地服务器，可使用 VSCode Live Server 等静态服务插件
