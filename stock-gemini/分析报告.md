# Stock-Gemini 项目分析报告

## 1. 项目概述

Stock-Gemini 是一个基于原生 HTML/CSS/JavaScript 的股票交易记录应用程序，无需任何外部依赖，可以直接在浏览器中运行。该应用允许用户跟踪股票交易、计算持仓、分析盈亏，并支持数据的本地持久化存储。

## 2. 技术栈

- **前端技术**：原生 HTML5、CSS3、JavaScript (ES6+)
- **模块化**：使用 ES6 模块系统
- **数据存储**：浏览器 localStorage
- **测试**：自定义 HTML 测试框架
- **构建工具**：无构建流程，零依赖
- **响应式设计**：支持移动端和桌面端
- **主题支持**：深色模式适配

## 3. 项目架构

项目采用模块化架构，将功能划分为不同的文件：

1. **index.html** - 主页面结构，包含四个核心视图
2. **js/main.js** - 应用入口，启动 UI 逻辑
3. **js/ui.js** - DOM 渲染与事件交互处理
4. **js/calculations.js** - 业务计算逻辑（持仓、余额、盈亏等）
5. **js/storage.js** - 数据持久化与应用状态存取封装
6. **style.css** - 样式文件，包含深色模式支持
7. **tests/calculations.test.html** - 核心计算函数的单元测试

## 4. 核心功能模块

### 4.1 持仓管理
- 使用加权平均成本法计算持仓
- 实时显示账户总金额、整体盈亏、持仓市值和账户余额
- 支持按市值排序的持仓列表
- 提供买入/卖出快捷操作按钮

### 4.2 交易记录
- 支持添加、编辑、删除交易记录
- 交易类型包括买入和卖出
- 包含股票代码、名称、价格、数量和日期等信息
- 按日期倒序展示历史记录

### 4.3 盈亏分析
- 基于用户输入的现价或成本价计算未实现盈亏
- 提供总体收益概览和个股收益明细
- 计算收益率和总盈亏金额

### 4.4 系统设置
- 配置初始资金和美元汇率
- 实时股价输入和管理
- 数据导出/导入功能
- 支持清空应用数据

## 5. 数据结构

### 5.1 交易记录
```javascript
{
  id: string,           // 唯一标识符
  code: string,         // 股票代码（如 "AAPL"）
  name: string,         // 股票名称（如 "Apple"）
  type: 'buy'|'sell',   // 交易类型
  price: number,        // 价格（每股）
  quantity: number,     // 数量
  date: string          // 交易日期（YYYY-MM-DD格式）
}
```

### 5.2 本地存储
- `stockTransactions`：交易记录数组
- `userStockPrices`：用户自定义的股票价格映射
- `initialFunds`：初始资金
- `exchangeRate`：美元兑人民币汇率
- `currentTab`：最后一次访问的视图标签

## 6. 核心业务逻辑

### 6.1 成本计算
采用加权平均成本法：
- 买入时：更新总成本和平均成本
- 卖出时：按当前均价比例冲减总成本

### 6.2 账户余额计算
```
余额 = 初始资金 - 买入总额 + 卖出总额 - 交易佣金
```

### 6.3 佣金计算
- 每股 0.02 美元，最低 5 美元

### 6.4 表单校验
- 买入前校验账户余额是否足够
- 卖出前校验持仓数量是否足够
- 提示最大可买数量

## 7. UI/UX 设计

### 7.1 视觉设计
- 深色模式支持（基于系统偏好）
- 红涨绿跌配色方案（符合国内用户习惯）
- 响应式布局，适配移动端和桌面端

### 7.2 交互设计
- 四个主要视图：持仓、历史、盈亏、设置
- 底部导航栏快速切换视图
- 持仓页面提供买入/卖出快捷操作
- 实时更新的账户信息概览

## 8. 测试策略

项目采用自定义的 HTML 测试框架：
- 针对核心计算函数进行单元测试
- 包含持仓计算、账户余额计算和盈亏分析测试用例
- 在浏览器中直接运行测试

## 9. 项目优势

1. **零依赖**：无需构建工具，直接在浏览器中运行
2. **本地持久化**：完整的数据存储和导入/导出功能
3. **良好的用户体验**：交互流畅，关键校验齐全
4. **移动端友好**：响应式设计适配移动设备
5. **视觉符合习惯**：深色模式和红涨绿跌配色

## 10. 项目限制

1. **无实时行情**：缺少实时股票价格数据
2. **成本法限制**：仅支持加权平均成本法
3. **精度问题**：使用浮点数进行金额计算存在精度风险
4. **单文件逻辑**：部分逻辑集中在单个文件中，可维护性受限
5. **单一账户**：仅支持单账户和单币种（USD）

## 11. 改进建议

1. **结构化改进**：
   - 进一步拆分模块，提高可维护性
   - 引入更完善的单元测试框架

2. **金融功能增强**：
   - 支持手续费、印花税等更复杂的费用模型
   - 区分已实现和未实现盈亏

3. **数据质量提升**：
   - 采用定点或十进制库避免浮点误差
   - 增强数据校验和去重功能

4. **功能扩展**：
   - 接入行情数据源
   - 支持多账户和多币种

## 12. 部署和运行

- 直接在浏览器中打开 `index.html` 文件即可运行
- 可使用 `npm run serve` 启动本地服务器（端口 5173）
- 使用 `npm run test` 运行测试

## 13. 总结

Stock-Gemini 是一个设计良好的个人股票交易记录应用，具有简洁的架构和实用的功能。项目展示了如何使用原生 Web 技术构建一个功能完整的应用程序，同时保持代码的可读性和可维护性。尽管存在一些限制，但它为个人投资者提供了一个轻量级、易用的股票交易管理解决方案。